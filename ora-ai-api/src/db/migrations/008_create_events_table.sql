-- Migration 008: Create Events Table for Analytics -- Tracks user events for analytics and product insights CREATE TABLE IF NOT EXISTS events ( id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL, event_type VARCHAR(100) NOT NULL, properties JSONB DEFAULT '{}', timestamp TIMESTAMPTZ DEFAULT NOW(), created_at TIMESTAMPTZ DEFAULT NOW() ); -- Indexes for performance CREATE INDEX IF NOT EXISTS idx_events_user_id ON events(user_id); CREATE INDEX IF NOT EXISTS idx_events_event_type ON events(event_type); CREATE INDEX IF NOT EXISTS idx_events_timestamp ON events(timestamp DESC); CREATE INDEX IF NOT EXISTS idx_events_user_timestamp ON events(user_id, timestamp DESC); -- Composite index for common analytics queries CREATE INDEX IF NOT EXISTS idx_events_type_timestamp ON events(event_type, timestamp DESC); -- GIN index for properties JSONB queries CREATE INDEX IF NOT EXISTS idx_events_properties ON events USING GIN(properties); -- Comments documenting the event types COMMENT ON TABLE events IS 'User events for analytics tracking'; COMMENT ON COLUMN events.event_type IS 'Event type: app_open, meditation_start, meditation_complete, letter_sent, post_created, etc.'; COMMENT ON COLUMN events.properties IS 'Flexible JSON object with event-specific data';